/* Generated by CodeDescriptor 1.5.0.0907 */
/*
* Project Name      -> stringHandler
* Version           -> 1.0.1.1124
* Author            -> Hm @ Workstadion.: QP-01-02
* Build Date        -> 20.09.2017 07:50:01
* Description       -> Description
*
*
*
*/

#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "Headers/cmd.h"


const cmdTable_t cmdTab[] =	
{
	{"Relais_Handler!" 			, 	"-REL"		, 	NULL 	},
	{"System_Handler!" 			, 	"-SYS"		, 	NULL 	},
	{"Eeprom_Handler!" 			, 	"-EEP"		, 	NULL 	},
};

cmd_t cmd =					
{
	.table	= cmdTab,
	.tabLen = sizeof( cmdTab ) / sizeof( *cmdTab ),
	.raw 	= &raw
};


static uint8_t 		cmdCntPara			( char *cmd )
{
	uint8_t x;
	char *cmdPtr = cmd;
	
	for ( x = 0 ; cmdPtr != NULL ;  )
	{
		cmdPtr = strchr( cmdPtr + 1 , '.' );
		x++;
	}
	
	return ( x - 1 );
}

static char			*cmdSearch			( char *inBuff , char *srchCmd )				
{
	/*
	*	Zeiger deklarieren).
	*/
	char *inBuffPtr		= inBuff;
	char *srchCmdPtr	= srchCmd;
	char *cmdBeginnPtr 	= NULL;
	char *cmdEndPtr		= NULL;
	
	if ( inBuffPtr == NULL )
	{
		return "1";
	}

	if ( srchCmdPtr == NULL )
	{
		return "2";
	}

	cmdBeginnPtr = strstr( inBuffPtr , srchCmdPtr );
	cmdEndPtr	 = strchr( inBuffPtr , CMD_DATA_END );	      

	if ( cmdEndPtr == NULL )
	{
		return "3";
	}

	return cmdBeginnPtr;
}

const char			*cmdGet				( cmd_t cmd , char *input )					
{
	uint8_t i;
	
	cmd_t 	*cmdPtr			= &cmd;
	char  	*cmdSearchPtr 	= NULL;
	char  	*inputPtr		= input;
	char	*rawPtr			= NULL;

	for ( i = 0 ; i < cmdPtr->tabLen ; i++ )
	{
		cmdSearchPtr = cmdSearch( inputPtr , ( char* ) cmdPtr->table->instruction );	
		
		if ( cmdSearchPtr != NULL )
		{
			cmdPtr->raw->paraNumb = cmdCntPara( cmdSearchPtr );
				
			rawPtr = strchr( cmdSearchPtr , ':' );
			if ( rawPtr == NULL )
			{
				return cmdPtr->table->instruction;
			}
			else
			{
				return cmdSearchPtr;	
			}
		}
		cmdPtr->table++;
	}
	
	return NULL;
}

char 				*cmdGetPara 		( cmd_t cmd , char *input , uint8_t num )
{
	char 		*delimiter 	= NULL;
	char 		*cmdEndPtr	= NULL;
	const char 	*rawPtr		= NULL;
	cmd_t 		*cmdPtr		= &cmd;
	
	uint8_t x;
	
	rawPtr = ( const char *) cmdGet( cmd , input );
	
	if( rawPtr == NULL )
	{
		return NULL;
	}
	
	cmdEndPtr = strchr( rawPtr , ';' );	
	if( cmdEndPtr == NULL )
	{
		return  NULL;
	}

	delimiter = strchr( rawPtr , ':' ) + 1;
	if( ( delimiter - 1 ) == NULL )
	{
		return  NULL;
	}

	delimiter = strtok( delimiter , CMD_RAW_PARA_DELIMITER );
	if( delimiter == NULL )
	{
		return  NULL;
	}
	
	for ( x = 0 ; x < num || x < cmd.raw->paraNumb ; x++ )
	{
		delimiter = strtok( NULL , CMD_RAW_PARA_DELIMITER );			
	}
		
	return delimiter; 
}

